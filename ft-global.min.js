/* ---------------------------------------------------------
   Fluid Topics – Global JavaScript Add-on
   This script can be imported into any FT portal to share
   common logic across multiple environments (DEV/QA/PROD).
---------------------------------------------------------- */

(function () {
    console.log("FT Global Script Loaded");

    /* ---------------------------------------------
       Utility: Wait for Fluid Topics to be ready
    ---------------------------------------------- */
    function onFTReady(callback) {
        if (window.FT && window.FT.hasLoaded) {
            callback();
        } else {
            document.addEventListener("ft-event-ready", callback);
        }
    }

    /* ---------------------------------------------
       GLOBAL CONFIG / OVERRIDES
    ---------------------------------------------- */
    const GLOBAL_SETTINGS = {
        version: "1.0",
        enableFeatureX: true,
        highlightTerms: ["RDS", "sample", "clarification"],
    };

    /* ---------------------------------------------
       Example: Add custom CSS globally
    ---------------------------------------------- */
    function injectGlobalCSS() {
        const css = `
            .ft-custom-highlight {
                background: yellow;
                padding: 2px 4px;
                border-radius: 4px;
            }
        `;
        const style = document.createElement("style");
        style.textContent = css;
        document.head.appendChild(style);
    }

    /* ---------------------------------------------
       Example: Highlight keywords inside articles
    ---------------------------------------------- */
    function highlightKeywords() {
        const article = document.querySelector("article");
        if (!article) return;

        GLOBAL_SETTINGS.highlightTerms.forEach(term => {
            article.innerHTML = article.innerHTML.replace(
                new RegExp(term, "gi"),
                match => `<span class="ft-custom-highlight">${match}</span>`
            );
        });
    }

    /* ---------------------------------------------
       Example: Run code when a topic opens
    ---------------------------------------------- */
    function onTopicLoaded() {
        document.addEventListener("ft-event-topic-opened", () => {
            console.log("Topic Loaded → Applying global logic");
            highlightKeywords();
        });
    }

    /* ---------------------------------------------
       Initialize everything
    ---------------------------------------------- */
    onFTReady(() => {
        console.log("Fluid Topics Ready → Starting Global Script v" + GLOBAL_SETTINGS.version);
        injectGlobalCSS();
        onTopicLoaded();
    });

})();
